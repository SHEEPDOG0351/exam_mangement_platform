<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mangment</title>
</head>

<style>

    body {
        background-color: black;
        color: white;
    }

    h1 {
        text-align: center;
    }

    .div-body {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    .div-body-content {
        width: 40%;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        flex-direction: column;
        background-color: rgb(27, 27, 27);
        padding: 30px 0px;
    }

    button {
        background-color: red;
        color: white;
        padding: 10px 50px;
        border: 1px transparent solid;
        border-radius: 5px;
        font-size: 20px;
    }

    .create-test-body {
        margin-top: 15px;
    }

    .create-test-buttons {
        margin-top: 20px;
    }

    .question-block input {
        border: 1px transparent solid;
        border-radius: 5px;
        padding: 15px 10px;
        font-size: 20px;
    }

    .question-type {
        border: 1px transparent solid;
        border-radius: 5px;
        padding: 15px 10px;
        font-size: 20px;
    }

    #test-id-input {
        border: 1px transparent solid;
        border-radius: 5px;
        padding: 15px 10px;
        font-size: 20px;
    }

</style>

<body>
    <header>
        <div class="topBar">
          <div class="">
            <img src="../static/images/logo.jpg" alt="Logo" class="logo">
            <ul class="barItem">
              <li><a href="{{ url_for('index') }}">HOME</a></li>
              <li><a href="{{ url_for('accounts') }}">Accounts</a></li>
              <li><a href="{{ url_for('signup') }}">Signup</a></li>
              <li><a href="{{ url_for('login') }}">Login</a></li>
              <li><a href="{{ url_for('test_Mangment') }}">Test Mangment</a></li>
              <li><a href="{{ url_for('take_test') }}">Test</a></li>
              <li><a href="{{ url_for('') }}"></a></li>
            </ul>
          </div>
      </header>
    <h1>Create, Edit or Delete a Test</h1>

    <div class="div-body">
        <div class="div-body-content">
            <div class="div button-content">
                <button>Create</button>

                <button>Edit</button>
            </div>

            <div class="create-test-body">
                <form action="" id="test-form">
                    <!-- Single question block -->
                    <div class="question-block">
                        <input type="text" name="question[]" placeholder="Enter your question..." required>
            
                        <!-- Select question type -->
                        <select class="question-type" name="question_type[]">
                            <option value="short">Short Answer</option>
                            <option value="multiple">Multiple Choice</option>
                        </select>
            
                        <!-- Multiple choice options -->
                        <div class="multiple-choice-options" style="display: none;">
                            <div class="choice">
                                <input type="text" name="choice[]" placeholder="Enter choice">
                            </div>
                        </div>
                        <button type="button" class="add-choice-btn">Add another choice</button>
                    </div>

                    <div class="create-test-buttons">
                        <!-- Add another question -->
                        <button type="button" id="add-question-btn">Add Another Question</button>
                
                        <!-- Submit test -->
                        <button type="submit">Submit Test</button>
                    </div>
                </form>
            </div>

            <div class="edit-test-body">
                <form action="" id="edit-tests-form">
                    <input type="text" name="test_id" id="test-id-input" placeholder="Desired Test ID">
                </form>
            </div>
        </div>
    </div>
</body>

<script>

    // ----------------------------------------- Correct Create / Edit Button functionality Below -------------------------------------------------

    const create_button = document.querySelectorAll(".button-content button")[0];
    const edit_button = document.querySelectorAll(".button-content button")[1];

    create_button.addEventListener("click", function() {

        // First, ensure the create test body is hidden
        const create_test_body = document.querySelector(".create-test-body")
        create_test_body.style.display = "none"

        // Second, display the edit test body
        const edit_test_body = querySelector(".edit-test-body")
        edit_test_body.style.display = "flex"
    })

    // -------------------------------------------------- Create Test functionality below -----------------------------------------------------

    const multiple_choice_add_code = `<div class="choice"><input type="text" name="choice[]" placeholder="Enter choice"></div>`
    const where_to_add_code = document.querySelector(".add-choice-btn") // I'm thinking of adding the code above the button

    document.querySelectorAll(".add-choice-btn").forEach(button => {
        button.addEventListener("click", function () {
            const container = button.closest(".multiple-choice-options");
            button.insertAdjacentHTML("beforebegin", multiple_choice_add_code);
        });
    });
    
    document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".question-type").forEach(select => {
        select.addEventListener("change", function () {
            const questionBlock = select.closest(".question-block");
            const multipleChoice = questionBlock.querySelector(".multiple-choice-options");

            if (select.value === "short") {
                multipleChoice.style.display = "none";

                
                const choices = multipleChoice.querySelectorAll(".choice");
                choices.forEach((choice, index) => {
                    if (index > 0) choice.remove(); // remove extra ones
                    else choice.querySelector("input").value = ""; // clear first
                });
            } else if (select.value === "multiple") {
                multipleChoice.style.display = "flex";
            }
        });
    });

    // "Add another choice" buttons
    document.querySelectorAll(".add-choice-btn").forEach(button => {
        button.addEventListener("click", function () {
            const container = button.closest(".question-block").querySelector(".multiple-choice-options");
            const html = `<div class="choice"><input type="text" name="choice[]" placeholder="Enter choice"></div>`;
            button.insertAdjacentHTML("beforebegin", html);
        });
    });
});

// ---------------------------------------- "Edit" / "Delete" test functionality JavaScript Code Below ----------------------------------------------------

    async function loadTest(testId) {
            const response = await fetch(`/api/test/${testId}`);
            const data = await response.json();

            console.log(data); // test_id, test_name, questions array
            // Now you can assign it to variables or populate the page
        }

        loadTest(24); // or dynamically trigger this from a dropdown

</script>
</html>